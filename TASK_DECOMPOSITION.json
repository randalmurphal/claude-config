{
    "master_task": {
        "id": "agent_response_analyzer_system",
        "description": "Build a comprehensive agent response analyzer system that uses checkpoint-based processing to never reprocess transcript entries, fully integrates with PRISM MCP for hallucination/drift detection, implements SubagentStop and Stop hooks, has NO FALLBACKS - must use PRISM or fail, and includes comprehensive tests in /tmp",
        "total_subtasks": 5,
        "estimated_total_time": "2-3 hours"
    },
    "execution_strategy": "sequential",
    "subtasks": [
        {
            "id": "checkpoint_foundation",
            "order": 1,
            "description": "Create checkpoint-based transcript processing foundation",
            "orchestration_prompt": "Implement a robust checkpoint system that tracks processed transcript entries to avoid reprocessing. Create data models for transcript entries, checkpoint state management, and persistent storage using JSON files. Include utilities for reading/writing checkpoints and validating transcript entry uniqueness.",
            "success_criteria": [
                "Checkpoint state can be saved and loaded from disk",
                "Transcript entries have unique identifiers",
                "System can detect already-processed entries",
                "Checkpoint validation prevents duplicate processing",
                "Basic data models are complete and tested"
            ],
            "dependencies": [],
            "estimated_complexity": "medium",
            "checkpoint": {
                "type": "functional",
                "validation": "Can track and skip processed transcript entries"
            }
        },
        {
            "id": "prism_integration_core",
            "order": 2,
            "description": "Integrate PRISM MCP for response analysis with NO FALLBACKS",
            "orchestration_prompt": "Create a response analyzer that uses PRISM MCP exclusively for hallucination detection, semantic drift calculation, and pattern analysis. Must fail hard if PRISM is unavailable - no fallback mechanisms. Build analyzer classes that leverage existing prism_client.py for all analysis operations including detect_hallucination, calculate_semantic_drift, and analyze methods.",
            "success_criteria": [
                "Response analyzer exclusively uses PRISM MCP",
                "Hallucination detection works through PRISM",
                "Semantic drift calculation functional",
                "System fails gracefully when PRISM unavailable",
                "No fallback code paths exist",
                "Integration with existing prism_client.py complete"
            ],
            "dependencies": ["checkpoint_foundation"],
            "estimated_complexity": "large",
            "checkpoint": {
                "type": "integration",
                "validation": "PRISM analysis works end-to-end with no fallbacks"
            }
        },
        {
            "id": "hook_implementation",
            "order": 3,
            "description": "Implement SubagentStop and Stop hooks for response capture",
            "orchestration_prompt": "Create hook implementations that capture agent responses at SubagentStop and Stop events, feeding them into the response analyzer. Integrate with existing hook system in settings.json, ensure proper data extraction from hook events, and store analysis results in PRISM memory. Build on existing agent_learner.py patterns.",
            "success_criteria": [
                "SubagentStop hook captures agent responses",
                "Stop hook captures session-end responses",
                "Hooks integrate with existing settings.json structure",
                "Response data flows to analyzer correctly",
                "Analysis results stored in PRISM",
                "Hook error handling prevents system failures"
            ],
            "dependencies": ["prism_integration_core"],
            "estimated_complexity": "medium",
            "checkpoint": {
                "type": "functional",
                "validation": "Hooks capture and analyze responses automatically"
            }
        },
        {
            "id": "pattern_detection_storage",
            "order": 4,
            "description": "Implement pattern detection and PRISM memory storage",
            "orchestration_prompt": "Build comprehensive pattern detection for agent responses including recurring issues, successful strategies, hallucination patterns, and drift indicators. Store detected patterns in PRISM memory with proper categorization, metadata, and retrieval mechanisms. Create pattern analysis pipeline that feeds learning back into the system.",
            "success_criteria": [
                "Pattern detection identifies recurring response issues",
                "Successful strategies are captured and stored",
                "Hallucination patterns are tracked",
                "PRISM memory stores patterns with rich metadata",
                "Pattern retrieval and analysis pipeline works",
                "Historical pattern data influences future analysis"
            ],
            "dependencies": ["hook_implementation"],
            "estimated_complexity": "large",
            "checkpoint": {
                "type": "data",
                "validation": "Patterns are detected, stored, and retrievable from PRISM"
            }
        },
        {
            "id": "comprehensive_testing",
            "order": 5,
            "description": "Create comprehensive test suite in /tmp",
            "orchestration_prompt": "Build extensive test coverage for all components in /tmp directory including unit tests for checkpoint system, integration tests for PRISM MCP, hook testing with mock events, pattern detection validation, and end-to-end system tests. Include test data, mocks for PRISM when needed for unit tests, and performance testing for large transcript processing.",
            "success_criteria": [
                "Unit tests cover all core components (95%+ coverage)",
                "Integration tests validate PRISM MCP interactions",
                "Hook tests use realistic event data",
                "Pattern detection tests verify accuracy",
                "End-to-end tests prove system functionality",
                "All tests located in /tmp and runnable",
                "Performance tests validate efficiency"
            ],
            "dependencies": ["pattern_detection_storage"],
            "estimated_complexity": "large",
            "checkpoint": {
                "type": "functional",
                "validation": "All tests pass and system is fully validated"
            }
        }
    ],
    "progress": {
        "completed": [],
        "current": null,
        "remaining": ["checkpoint_foundation", "prism_integration_core", "hook_implementation", "pattern_detection_storage", "comprehensive_testing"]
    },
    "architecture_notes": {
        "key_integrations": [
            "Existing prism_client.py for PRISM MCP communication",
            "Existing agent_learner.py patterns for hook implementation",
            "Existing settings.json hook configuration structure",
            "Existing universal_learner.py for pattern storage"
        ],
        "no_fallback_requirement": "System must fail if PRISM unavailable - no graceful degradation",
        "checkpoint_strategy": "JSON-based persistence for tracking processed transcript entries",
        "test_location": "/tmp directory for all test files and data"
    }
}