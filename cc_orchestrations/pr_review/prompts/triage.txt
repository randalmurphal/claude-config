# PR Review Triage

## Your Mission

Analyze this PR to determine:
1. **Risk level** (based on blast radius, not file count)
2. **Which reviewers are needed** (based on what the code DOES, not file paths)

You are providing INFORMATION for the orchestration. You cannot skip reviewers or phases.

---

## Investigation Steps

**Read the changed files. Don't just look at names - investigate the actual code.**

### 1. Shared Code Impact
- Files in `common/`, `fis_common/`, shared utilities?
- Grep for imports of changed modules
- Count callers of modified functions

### 2. Data Operations
- MongoDB calls: `collection.find`, `update_one`, `delete_many`, `aggregate`
- Schema changes to business objects?
- DBOpsHelper usage, flush patterns?

### 3. API Changes
- Flask routes, endpoint signatures?
- Request/response format changes?
- Auth decorator changes?

### 4. Test Coverage
- Do test files exist for changed modules?
- Are test files updated in the diff?

### 5. Breaking Changes
- Signature changes, return type changes
- Required field additions
- Removed or renamed exports

---

## Risk Assessment

| Risk Level | Indicators |
|------------|------------|
| **LOW** | Isolated changes, single caller, well-tested, internal code |
| **MEDIUM** | Multiple callers, some shared code, test gaps |
| **HIGH** | Shared utilities, many callers, data mutations, API changes |

Key question: **If this PR has a bug, how bad is it and how many things break?**

---

## Reviewer Selection

Based on what you find in the code, select which reviewers are needed:

| Finding | Reviewer |
|---------|----------|
| MongoDB operations (find, update, aggregate) | mongo-ops-reviewer |
| Business object structure (md.*, info.*, data.*) | bo-structure-reviewer |
| BO field changes, r3 frontend impact | schema-alignment-reviewer |
| Import/data processing (data_importer, DBOpsHelper) | import-framework-reviewer |
| API endpoints (@app.route, blueprints) | api-security-reviewer |
| Performance-sensitive (loops, bulk ops, aggregations) | performance-reviewer |
| Architectural changes (new modules, 10+ files) | architecture-reviewer |

**Required reviewers run regardless of your analysis.**
Only select conditional reviewers that are actually relevant based on code investigation.

---

## Output Format

Return JSON:
```json
{
  "risk_level": "low|medium|high",
  "risk_reasoning": "Brief explanation based on investigation",
  "blast_radius": {
    "files_importing_changes": 5,
    "shared_code_modified": true,
    "data_operations": ["update_one in imports/foo.py:123"],
    "api_changes": false
  },
  "agents_to_run": ["agent-name-1", "agent-name-2"],
  "agent_reasoning": {
    "mongo-ops-reviewer": "Found aggregate call in line 45",
    "api-security-reviewer": "Skipped - no API changes"
  },
  "investigation_notes": ["anything unusual to watch for"]
}
```

---

## Important

- **Investigate actual code** - don't guess based on file names
- **Binary selection** - if a reviewer is relevant at all, include it
- **Can't skip phases** - you're providing information, not making skip decisions
- **Required reviewers always run** - don't waste time evaluating them
