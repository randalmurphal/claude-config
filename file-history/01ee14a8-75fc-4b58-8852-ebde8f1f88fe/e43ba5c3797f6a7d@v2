# Orchestration MCP - Intelligent Multi-Agent Workflow System

**Spec-driven orchestration for complex development tasks with living READY.md specifications, intelligent project analysis, and research-backed context patterns.**

---

## üöÄ Quick Start - Just Want to Use It?

**Read [SIMPLE_USAGE.md](./SIMPLE_USAGE.md) for the actual API that works.**

The rest of this README is architectural details. The simple guide shows you exactly what formats to use.

## ‚ö†Ô∏è NO DEFAULTS Philosophy

This system operates on a **NO DEFAULTS, NO FALLBACKS** principle:
- System MUST crash if requirements not met
- ALL configuration values must be explicit
- NEVER silent failures or arbitrary defaults
- FULL POWER or CRASH - no degraded functionality

## üéØ What's New (Phases 1-5 Complete)

### Intelligent Specifications
- **READY.md** living specification format (13 sections: 10 required, 3 optional)
- **ProjectAnalyzer** auto-detects language, frameworks, dependencies
- **Spec Evolution** automatic updates during execution with git commits
- **Custom Roles** project-specific agent configurations (three-tier resolution)

### Enhanced Intelligence
- **PRISM integration** for similar project patterns and gotchas
- **Neo4j integration** for prior architectural decisions
- **Confidence scoring** for all suggestions (0.0-1.0)
- **Graceful degradation** when intelligence unavailable

## üöÄ Core Features

### 1. Living Specifications (READY.md)

**Format:** `.prelude/READY.md` in your project

**13 Sections:**
- Problem Statement, User Impact, Mission
- Requirements (IMMUTABLE), Proposed Approach (EVOLVABLE)
- Success Criteria, Implementation Phases
- Known Gotchas, Quality Requirements
- Files to Create/Modify
- Custom Roles (optional), Auto-Detected Context (optional)
- Evolution Log (optional) - auto-populated

**See:** `docs/READY_SPECIFICATION.md` for complete format reference

### 2. Intelligent Project Analysis

**ProjectAnalyzer** automatically detects:
- Language (Python, JavaScript, TypeScript, Go)
- Frameworks (FastAPI, React, Express, Gin, etc.)
- Dependencies from package files
- Architecture patterns (REST API, Microservices, SPA, etc.)
- File complexity metrics

**Plus intelligence from:**
- **PRISM** - Similar projects, file patterns, known gotchas
- **Neo4j** - Prior decisions, dependency graphs

**See:** `docs/PROJECT_ANALYZER.md` for usage guide

### 3. Custom Role System

**Three-tier resolution:**
1. Project roles (READY.md Custom Roles section)
2. Global roles (`config/roles.yaml`)
3. Default roles (built-in presets)

**Configure:**
- Model selection (haiku/sonnet/opus)
- Specialized expertise
- Validation strictness (strict/checkpoint/loose)
- Inheritance from base roles

**See:** `docs/CUSTOM_ROLES.md` for configuration guide

### 4. Spec Evolution During Execution

**Automatic updates:**
- Gate failures ‚Üí add to Known Gotchas
- Discoveries ‚Üí update Proposed Approach
- New files needed ‚Üí add to Files section
- Performance insights ‚Üí update Quality Requirements

**With git commits** after each update to Evolution Log.

### 5. Research-Backed Context Patterns

**6 patterns from Manus, LlamaIndex, Augment Code (2025):**
1. **Mission Recitation** - Objectives at START and END
2. **Layered Context** - PRIMARY/SECONDARY/REFERENCE structure
3. **Self-Check Gates** - Agents answer 4 questions before completion
4. **Graduated Autonomy** - Validation strictness varies by agent type
5. **Semantic Filtering** - PRISM filters learnings by relevance
6. **TODO Tracking** - Constant objective recitation

## üìã Installation

### Prerequisites
- Python 3.10+
- Redis (ephemeral state, port 6381)
- Neo4j 5.13+ (knowledge graph)
- Optional: PRISM MCP for semantic enhancements

### Install Package

```bash
cd orchestration_mcp
pip install -e .
```

This installs the `orchestration-mcp` command globally.

### Configure System

1. **Copy configuration template**:
   ```bash
   cp config/config.template.yaml config/config.yaml
   ```

2. **Edit config.yaml**:
   ```yaml
   database:
     redis_url: "redis://localhost:6381"
     neo4j_uri: "bolt://localhost:7687"
     neo4j_user: "neo4j"
     neo4j_password: "your-password"  # CHANGE ME

   # Optional: Comment out to disable PRISM
   prism:
     host: "localhost"
     http_port: 8090

   server:
     name: "orchestration-mcp"
     version: "0.3.0"
     log_level: "INFO"

   workflow:
     max_concurrent_agents: 10
     agent_timeout_seconds: 600
     enable_checkpoints: true
   ```

3. **No environment variables required** - everything in config.yaml

### Configure Claude Code

Add to `~/.config/claude-code/mcp.json`:

```json
{
  "mcpServers": {
    "orchestration": {
      "command": "orchestration-mcp",
      "env": {}
    }
  }
}
```

**That's it!** Server reads `config/config.yaml` automatically.

## üîå MCP Tools (11 Total)

### Core Workflow (7 tools)
1. **start_task** - Start task with READY.md specification
2. **prepare_phase** - Prepare phase: chambers, contexts, learnings, role resolution
3. **finalize_phase** - Finalize: checkpoints, validation, merge, track gate failures
4. **record_phase_result** - Record decisions and gotchas to Neo4j
5. **complete_task** - Complete task and clear graph
6. **get_task_status** - Get current task status
7. **parse_ready_specification** - Parse .prelude/READY.md

### Intelligence Tools (4 new tools)
8. **analyze_project** - Auto-detect language, frameworks, suggest files/gotchas
9. **augment_ready_spec** - Add analysis suggestions to READY.md
10. **validate_ready_spec** - Validate READY.md format and sections
11. **synthesize_learnings** - Post-completion synthesis to PRISM/Neo4j

All tools use `mcp__orchestration__*` prefix.

## üìñ Complete Workflow

### Phase 0: Preparation (Optional)
```
analyze_project ‚Üí augment_ready_spec ‚Üí validate_ready_spec
```
- Analyze project automatically
- Augment READY.md with suggestions
- Validate format before starting

### Execution: Standard 3-Phase Pattern
```
start_task ‚Üí prepare_phase ‚Üí [agents work] ‚Üí finalize_phase ‚Üí complete_task
```
- **prepare_phase**: Load custom roles, build contexts, query learnings
- **finalize_phase**: Run checkpoints, track failures to Evolution Log
- Custom roles applied to agents automatically

### Phase N+1: Synthesis (Optional)
```
synthesize_learnings ‚Üí Evolution Log + PRISM/Neo4j storage
```
- Generate summary from Evolution Log
- Store learnings for future projects

## üìä Impact Analysis

### Before (Phase 0)
- Static READY.md, never evolves
- No project analysis
- Generic agent roles
- Manual gotcha tracking
- 40-60 tool calls per task

### After (Phases 1-5)
- Living READY.md with automatic evolution
- Intelligent project analysis with PRISM/Neo4j
- Project-specific custom roles
- Automatic gotcha tracking to Evolution Log
- 8-10 tool calls per task (projected)

## üõ†Ô∏è Architecture

```
Main Claude Agent
    ‚Üì
Orchestration MCP (stdio)
    ‚îú‚îÄ READY.md Parser (13 sections)
    ‚îú‚îÄ ProjectAnalyzer (language/framework detection)
    ‚îú‚îÄ RoleManager (three-tier resolution)
    ‚îú‚îÄ SpecEvolutionTracker (live updates + git)
    ‚îú‚îÄ WorkflowCoordinator (3-phase pattern)
    ‚îú‚îÄ Redis (ephemeral state)
    ‚îú‚îÄ Neo4j (knowledge graph + decisions)
    ‚îî‚îÄ PRISM HTTP API (semantic filtering, optional)
        ‚îî‚îÄ Qdrant (21K+ patterns)
```

## üìö Documentation

### Guides
- **docs/READY_SPECIFICATION.md** - Complete READY.md format reference
- **docs/PROJECT_ANALYZER.md** - Project analysis usage guide
- **docs/CUSTOM_ROLES.md** - Role configuration guide
- **CLAUDE.md** - Working instructions for development

### Examples
- **examples/ready_fastapi_project.md** - Python FastAPI REST API
- **examples/ready_typescript_react.md** - TypeScript React SPA
- **examples/ready_go_microservice.md** - Go event-driven service

### Legacy Docs
- `docs/IMPLEMENTATION_COMPLETE.md` - Pattern implementation details
- `docs/IMPLEMENTATION_GUIDE.md` - 6 research-backed patterns

## üß™ Testing

### Test Configuration
```bash
cd orchestration_mcp
python3 -c "from orchestration_mcp.utils.config import load_config; cfg = load_config(); print(f'‚úÖ Config OK: {cfg.server.name}')"
```

### Run Server
```bash
orchestration-mcp
```

### Test Tools (via Claude Code)
```
# Analyze a project
analyze_project(working_directory="/my-project")

# Augment READY.md with suggestions
augment_ready_spec(
    ready_file_path="/my-project/.prelude/READY.md",
    working_directory="/my-project"
)

# Validate format
validate_ready_spec(ready_file_path="/my-project/.prelude/READY.md")
```

## ‚ö° Key Principles

### DO
‚úÖ Create `.prelude/READY.md` in your projects
‚úÖ Use Custom Roles for project-specific needs
‚úÖ Let spec evolution happen automatically
‚úÖ Review suggested files/gotchas before accepting
‚úÖ Crash loudly when requirements not met

### DON'T
‚ùå Skip required READY.md sections (parser fails)
‚ùå Manually edit Evolution Log (it's automatic)
‚ùå Use defaults for required fields
‚ùå Override global roles unnecessarily
‚ùå Put flexible choices in Requirements (IMMUTABLE)

## üéØ Quick Start Checklist

1. ‚úÖ Install orchestration-mcp: `pip install -e .`
2. ‚úÖ Configure `config/config.yaml` with database credentials
3. ‚úÖ Add to Claude Code `mcp.json`
4. ‚úÖ Create `.prelude/READY.md` in your project (see examples/)
5. ‚úÖ Run `analyze_project` to get suggestions
6. ‚úÖ Optionally `augment_ready_spec` to add suggestions
7. ‚úÖ Use `/conduct` to start orchestrated task

## üìà Stats

- **157 tests passing** (100% from phases 1-4)
- **11 MCP tools** (7 core + 4 intelligence)
- **4 core modules** (parser, analyzer, roles, evolution)
- **2320 lines** of test code
- **~5000 lines** of implementation
- **3 complete examples** (Python, TypeScript, Go)

## üìÑ License

MIT

---

**Built with NO DEFAULTS. Embracing crashes ensures quality.**