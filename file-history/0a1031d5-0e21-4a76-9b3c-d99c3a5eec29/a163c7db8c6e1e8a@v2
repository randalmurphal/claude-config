#!/usr/bin/env bash
# Test codebase indexing via HTTP API

PROJECT_PATH="/home/randy/repos/claude_mcp/prism_mcp"
API_URL="http://localhost:8090"
API_KEY="prism_development_key_2024"
PROJECT_ID="prism_mcp_test"

echo "üîç Testing codebase indexing via HTTP API..."
echo "   Target: $PROJECT_PATH"
echo "   API: $API_URL"
echo

# Check API health
echo "1. Checking API health..."
curl -s "$API_URL/health" | jq .
echo

# Start indexing
echo "2. Starting index (this may take 1-2 minutes)..."
curl -X POST "$API_URL/api/index/start" \
  -H "Authorization: Bearer $API_KEY" \
  -H "Content-Type: application/json" \
  -d "{
    \"project_path\": \"$PROJECT_PATH\",
    \"project_id\": \"$PROJECT_ID\"
  }" | jq .
echo

# Check index state
echo "3. Checking index state..."
curl -s "$API_URL/api/index/state/$PROJECT_ID" \
  -H "Authorization: Bearer $API_KEY" | jq .