# PRISM + Orchestration MCP - Claude Code Enhancement System

## Overview

A comprehensive ecosystem that enhances Claude Code with intelligent pattern recognition, preference learning, and multi-agent workflow management. The system provides semantic memory, performance optimization, and seamless integration with existing Claude Code workflows.

## Core Capabilities

### PRISM MCP - Pattern Recognition & Intelligent Memory

- **6-Stage Intelligent Retrieval**: Semantic → Graph → Context → Temporal → Diversity → Scoring
- **4-Tier Memory System**: ANCHORS → LONGTERM → EPISODIC → WORKING with automatic promotion
- **Preference Learning**: Multi-signal effectiveness tracking with temporal decay
- **Performance Modes**: Lightning (<100ms) → Fast (<500ms) → Balanced (<2s) → Comprehensive (<20s)
- **Degradation Tiers**: Full GPU → Dual → Single → CPU → Keyword-only (graceful fallback)
- **Real Patterns**: 156K+ patterns from Django, Flask, FastAPI, and popular repositories

### Orchestration MCP - Multi-Agent Workflow Management

- **Sub-Agent Discovery**: Automatic detection of `~/.claude/agents/*.md` definitions
- **Phase-Aware Output Styles**: Automatic style switching (prepare/skeleton/implementation/validation)
- **Context Patterns**: Research-backed patterns for agent coordination
- **PRISM Integration**: Semantic filtering and memory sharing across workflows

### Claude Code Integration

- **CLAUDE.md Bidirectional Sync**: High-performing preferences ↔ documentation
- **Hook Integration**: PreToolUse pattern injection + PostToolUse learning
- **Real-Time Learning**: System learns from your corrections and preferences
- **Seamless Experience**: Works with existing Claude Code workflows

### Developer Experience

- **One-Command Setup**: `./setup.sh` installs entire ecosystem
- **Enhanced Error Messages**: Every error includes specific solutions and fix guidance
- **Comprehensive Health Monitoring**: Real-time system status and performance metrics
- **Zero-Friction Operations**: Automated database management and password generation

## Quick Start

```bash
git clone <this-repo>
cd claude_mcp
./setup.sh
```

The setup script handles everything:
- Prerequisites checking (nerdctl, Python, RAM, disk space)
- Database containers (Neo4j, Qdrant, Redis) with secure passwords
- Python package installation and configuration
- AI model downloads (~2-5GB) with progress tracking
- Pattern loading (156K patterns to databases)
- Comprehensive health validation

## System Architecture

### Core Components

**PRISM MCP** (`prism_mcp/`)
- **Core Engines**: Memory, retrieval, preferences, pattern detection
- **Storage Layer**: Qdrant (vectors), Neo4j (graph), Redis (cache)
- **Model System**: E5-Mistral, StarCoder2, BGE reranker with auto-tier detection
- **Integrations**: Claude Code hooks, CLAUDE.md sync, enhanced error handling
- **See**: `prism_mcp/CLAUDE.md` for AI agent technical guide

**Orchestration MCP** (`orchestration_mcp/`)
- **Services**: Sub-agent discovery, output style management
- **Integration**: PRISM semantic filtering and context sharing
- **Workflow Management**: Phase-aware agent coordination
- **See**: `orchestration_mcp/CLAUDE.md` for orchestration guide

**Database Infrastructure** (`nerdctl/` → automated by setup)
- **Neo4j**: Graph database with GDS plugin for PageRank and community detection
- **Qdrant**: Vector database for embeddings and similarity search
- **Redis**: Session cache and query result caching

### Integration Points

1. **Claude Code MCP Settings**: Standard MCP configuration in `~/.config/claude/mcp_config.json`
2. **Hook Integration**: Optional PreToolUse/PostToolUse hooks for real-time learning
3. **CLAUDE.md Sync**: Bidirectional preference ↔ documentation synchronization
4. **Sub-Agent Discovery**: Automatic discovery of custom agent definitions

## Management & Operations

### Daily Operations
```bash
./scripts/health_check.sh              # Quick system health check
./start_prism.sh                       # Start PRISM API server
./restart_databases.sh                 # Restart database containers
```

### System Monitoring
```bash
curl http://localhost:8092/api/health/detailed  # Comprehensive status JSON
nerdctl logs prism-neo4j                        # Database logs
tail -f setup.log                               # Setup progress
```

### Troubleshooting
```bash
./scripts/check_prerequisites.sh       # Verify system requirements
./scripts/cleanup.sh                   # Complete system removal
./setup.sh                            # Reinstall from scratch
```

## Key Capabilities

### For Developers
- **Instant Setup**: Single command setup process
- **Intelligent Assistance**: System learns your preferences and applies them automatically
- **Real-Time Feedback**: Hooks provide immediate pattern suggestions and critical warnings
- **Zero Maintenance**: Automated health monitoring and graceful degradation

### For AI Agents
- **Rich Memory System**: 4-tier memory with automatic promotion based on access and frustration
- **High-Performance Retrieval**: 4 modes optimized for different latency requirements
- **Preference Learning**: Multi-signal effectiveness tracking with temporal decay
- **Comprehensive APIs**: 25+ MCP tools for pattern detection, memory management, and analytics

### For Teams
- **Shared Learning**: Preferences and patterns can be shared via CLAUDE.md files
- **Comprehensive Error Handling**: Detailed error messages with specific solutions
- **Scalable**: Graceful degradation from GPU clusters to laptop CPUs
- **Observable**: Detailed metrics and logging for operational visibility

## Documentation

### For Users
- **[README.md](README.md)** - Complete setup and usage guide
- **Setup Scripts** - `./setup.sh` with comprehensive progress tracking
- **Management Commands** - Health checks, database management, system recovery

### For AI Agents
- **[prism_mcp/CLAUDE.md](prism_mcp/CLAUDE.md)** - Technical architecture and API guide
- **[orchestration_mcp/CLAUDE.md](orchestration_mcp/CLAUDE.md)** - Workflow orchestration guide

### For Developers
- **Configuration Templates** - `config/config.template.yaml` with comprehensive examples
- **API Documentation** - 25+ MCP tools with detailed parameters and examples
- **Error Handling** - Enhanced error messages with specific solutions

## Security Features

- **Authentication**: API key protection for all endpoints
- **Network Isolation**: Containers on isolated networks
- **Secure Defaults**: Secure random password generation
- **Local Processing**: All data remains on your machine
- **Input Validation**: Comprehensive validation for all inputs
- **NO DEFAULTS Philosophy**: System fails securely rather than degrading silently

## Design Principles

- **NO DEFAULTS**: System crashes loudly rather than degrading silently
- **Reliability First**: Built for operational excellence
- **Developer Experience**: Zero-friction setup and comprehensive error guidance
- **Performance Aware**: Automatic resource detection and optimization
- **Learning System**: Continuously improves from user interactions

## Integration with Claude Code

### Add to MCP Configuration

```json
{
  "mcpServers": {
    "prism": {
      "command": "python",
      "args": ["-m", "prism_mcp.interfaces.mcp_server"],
      "cwd": "/path/to/claude_mcp/prism_mcp"
    },
    "orchestration": {
      "command": "python",
      "args": ["-m", "orchestration_mcp.mcp_server"],
      "cwd": "/path/to/claude_mcp/orchestration_mcp"
    }
  }
}
```

### Test Integration

```bash
# Verify system health
./scripts/health_check.sh

# Test via Claude Code
claude "Show me system status and memory tiers"
claude "What patterns do you know about authentication?"
claude "Learn from this correction: prefer explicit error handling"
```