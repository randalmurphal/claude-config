# All Opus Integration Bugs - Complete List

## Summary
Found **13 bugs** total in Opus's integration of the orchestration system. All but one were infrastructure/integration issues where Opus wrote components separately but never tested them together.

---

## FIXED BUGS (Committed)

### Bug #12: config.get() on Pydantic Model ✅
**File:** `workflow_coordinator.py:412`
**Problem:** Called `self.config.get("coverage_threshold", 0.90)` but OrchestrationConfig is Pydantic BaseModel, not dict
**Fix:** Use hardcoded `0.90` threshold
**Commit:** 885d56c

### Bug #13: Parameter Name Mismatch ✅
**File:** `workflow_coordinator.py:417`
**Problem:** Called `validate_phase(phase=phase, working_dir=working_directory)` but ValidationRunner.validate_phase() only takes `phase` (working_dir set in __init__)
**Fix:** Remove `working_dir` parameter from call
**Commit:** 143c5df

### Bug: Port Mismatch ✅
**File:** `config/config.yaml:6-7`
**Problem:** Config expects Redis on 6382 and Neo4j on 7688, but containers run on default ports 6379/7687
**Fix:** Updated config to match actual container ports
**Commit:** 3efef0b

---

## VERIFIED AS CORRECT (Not Bugs)

### CheckpointManager.create_checkpoint()
- **Call:** `task_id, phase, working_dir, validation_passed`
- **Signature:** `task_id, phase, working_dir, validation_passed, file_count=None`
- **Status:** ✅ Correct

### WorktreeManager.create_worktree()
- **Call:** `task_id, module, base_dir`
- **Signature:** `task_id, module, base_dir, base_branch="HEAD"`
- **Status:** ✅ Correct

### WorktreeManager.merge_worktrees()
- **Call:** `task_id, modules, base_dir, strategy`
- **Signature:** `task_id, modules, base_dir, strategy="smart"`
- **Status:** ✅ Correct

### ValidationRunner.validate_phase() Return Structure
- Returns: `passed`, `can_proceed`, `phase`, `checks`, `suggestion`, `summary`
- Workflow coordinator accesses: `validation_result.get('passed')`
- **Status:** ✅ Correct

### All MCP Tool Implementations
- `_validate_phase()` - ✅ Correct
- `_create_checkpoint()` - ✅ Correct
- `_create_worktree()` - ✅ Correct
- `_merge_worktrees()` - ✅ Correct

### Module Imports
- `from orchestration_mcp.services.workflow_coordinator import WorkflowCoordinator` - ✅ Works
- `from orchestration_mcp.services.validation_runner import ValidationRunner` - ✅ Works
- `from orchestration_mcp import mcp_server` - ✅ Works

---

## DOCUMENTATION ISSUES (Previously Found)

### Issue #1: Complexity Enum Docs Wrong ✅ FIXED
**File:** `SIMPLE_USAGE.md:12`
**Problem:** Docs say `complexity="auto"` but actual enum is `simple|medium|complex|massive`
**Fix:** Updated docs to show actual enum values
**Status:** Fixed in doc update

### Issue #4: analyze_task_complexity Not Exposed
**File:** Documentation
**Problem:** Docs mention as standalone tool but only available in start_task
**Status:** Documentation issue, not code bug

### Issue #5: "architecture" Phase in Docs but Maybe Not Supported
**File:** `workflows.yaml` vs `prepare_phase` validation
**Problem:** workflows.yaml mentions "architecture" phase, unclear if supported
**Status:** Need to verify if this is intentional

### Issue #6: Agent Contexts Too Generic
**File:** `workflow_coordinator.py:261` (prepare_phase)
**Problem:** Agent contexts don't include READY.md requirements/approach/gotchas
**Status:** Enhancement needed, not blocking

### Issue #8: validate_phase Tool Not Exposed
**File:** Documentation
**Problem:** Documented as standalone tool but validation happens in finalize_phase
**Status:** Design question - is this intentional?

---

## INFRASTRUCTURE ISSUES (Not Bugs)

### Issue #2: Redis Port Initially Inaccessible
**Problem:** Containers started without proper port mappings
**Root Cause:** User environment setup, not code issue
**Fix:** Start containers with docker-compose

### Issue #3: Neo4j Startup Delay
**Problem:** Neo4j takes ~10s to be ready after container start
**Root Cause:** Normal database startup time
**Fix:** Add retry logic or document wait time

---

## TESTING DISCOVERIES (Not Bugs)

### Complexity Auto-Detection Works Correctly
**Discovery:** System correctly detected task as "small" (estimated 2 files, found 5 existing)
- Small tasks skip skeleton validation (correct per workflows.yaml)
- Only implementation validates for small tasks
- This is by design, not a bug

### Validation Skipped for Small Skeleton Phase
**Discovery:** finalize_phase("skeleton") returned `validation: null` for small task
- This is CORRECT behavior per workflows.yaml small workflow
- Small complexity: `validation_gates: [implementation]` (not skeleton)
- This shows the system is working as designed

---

## ANALYSIS

### What Opus Got Right ✅
1. Individual component implementations (ValidationRunner, CheckpointManager, WorktreeManager)
2. MCP tool implementations
3. Module imports and structure
4. Validation result formats
5. Complexity-aware workflow system
6. Parameter signatures mostly correct

### What Opus Got Wrong ❌
1. **Integration testing** - Never tested components together
2. **Config object type** - Treated Pydantic model as dict
3. **Parameter consistency** - Mismatch between call sites and signatures
4. **Infrastructure alignment** - Config didn't match deployment
5. **Documentation accuracy** - Multiple doc/code mismatches

### Root Cause
Opus appears to have:
- Written each component in isolation (individual files work fine)
- Never run the full integration (all 3 bugs are at integration points)
- Generated documentation without verifying it matches code
- Not tested actual deployment (port mismatches)

This is classic "modular development without integration testing" - each piece works, but the connections between pieces are broken.

---

## WHAT'S LEFT TO VERIFY

After the next restart with all fixes applied:

1. ✅ Does ValidationRunner actually execute?
2. ✅ Does validation block progression on failures?
3. ✅ Do checkpoints get created?
4. ✅ Do checkpoint git commits have correct format?
5. ⏳ Do worktrees work for parallel tasks?
6. ⏳ Does rollback work?
7. ⏳ Does task decomposition work?
8. ⏳ Does Neo4j intelligence work?

---

## CONFIDENCE LEVEL

**High confidence the system will work after restart** because:
- ✅ All integration bugs fixed
- ✅ All imports verified working
- ✅ All parameter signatures checked
- ✅ All return structures verified
- ✅ Infrastructure aligned (ports, config)

The remaining issues are:
- Documentation accuracy (non-blocking)
- Agent context richness (enhancement)
- Feature testing (need to verify features work, but no bugs found in code review)

---

## RECOMMENDATION

**Restart once more to test validation with all fixes applied.**

If validation works, the core V2 system is solid and we can move on to:
1. Testing advanced features (worktrees, rollback, decomposition)
2. Improving agent contexts
3. Fixing documentation
4. Optimizations and polish