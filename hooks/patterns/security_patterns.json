{
  "sql_injection": {
    "description": "Patterns that may lead to SQL injection vulnerabilities",
    "high_risk_patterns": [
      {
        "code": "cursor.execute(f\"SELECT * FROM {table}\")",
        "vulnerability": "String formatting in SQL queries",
        "impact": "Database compromise, data theft",
        "mitigation": "Use parameterized queries"
      },
      {
        "code": "query = \"SELECT * FROM users WHERE id = \" + user_id",
        "vulnerability": "String concatenation in SQL",
        "impact": "Unauthorized data access",
        "mitigation": "Use prepared statements"
      },
      {
        "code": "db.execute(\"UPDATE users SET name = '\" + name + \"'\")",
        "vulnerability": "Direct string insertion",
        "impact": "Data manipulation, privilege escalation",
        "mitigation": "Parameter binding"
      }
    ],
    "safe_patterns": [
      {
        "code": "cursor.execute(\"SELECT * FROM users WHERE id = %s\", (user_id,))",
        "description": "Parameterized query with placeholder"
      },
      {
        "code": "query = \"SELECT * FROM users WHERE id = ?\"\ndb.execute(query, [user_id])",
        "description": "Prepared statement with parameter binding"
      }
    ]
  },
  "command_injection": {
    "description": "Patterns that enable command injection attacks",
    "high_risk_patterns": [
      {
        "code": "os.system(user_input)",
        "vulnerability": "Direct system command execution",
        "impact": "Remote code execution, system compromise",
        "mitigation": "Validate input, use subprocess with shell=False"
      },
      {
        "code": "subprocess.call(shell_command, shell=True)",
        "vulnerability": "Shell command execution with user input",
        "impact": "Command injection, privilege escalation",
        "mitigation": "Use subprocess without shell, validate input"
      },
      {
        "code": "eval(user_data)",
        "vulnerability": "Dynamic code evaluation",
        "impact": "Arbitrary code execution",
        "mitigation": "Use ast.literal_eval or validate input strictly"
      }
    ],
    "safe_patterns": [
      {
        "code": "subprocess.run([\"command\", arg1, arg2], shell=False)",
        "description": "Safe subprocess execution without shell"
      },
      {
        "code": "import ast\nresult = ast.literal_eval(user_input)",
        "description": "Safe evaluation of literals only"
      }
    ]
  },
  "path_traversal": {
    "description": "Patterns that may enable path traversal attacks",
    "high_risk_patterns": [
      {
        "code": "open(user_path, \"r\")",
        "vulnerability": "Unvalidated file path access",
        "impact": "Unauthorized file access, information disclosure",
        "mitigation": "Validate and sanitize file paths"
      },
      {
        "code": "Path(user_input).read_text()",
        "vulnerability": "Direct path construction from user input",
        "impact": "Directory traversal, file system access",
        "mitigation": "Use secure path joining, validate paths"
      },
      {
        "code": "file_path = base_path + user_input",
        "vulnerability": "String concatenation for paths",
        "impact": "Path manipulation, unauthorized access",
        "mitigation": "Use os.path.join and validate result"
      }
    ],
    "safe_patterns": [
      {
        "code": "safe_path = os.path.join(BASE_DIR, secure_filename(user_input))\nif safe_path.startswith(BASE_DIR):\n    open(safe_path, 'r')",
        "description": "Validated path construction with containment check"
      },
      {
        "code": "from pathlib import Path\nbase = Path('/allowed/directory')\nfull_path = (base / user_input).resolve()\nif base in full_path.parents:\n    full_path.read_text()",
        "description": "Secure path resolution with parent validation"
      }
    ]
  },
  "deserialization": {
    "description": "Patterns involving unsafe deserialization",
    "high_risk_patterns": [
      {
        "code": "pickle.loads(data)",
        "vulnerability": "Arbitrary object deserialization",
        "impact": "Remote code execution",
        "mitigation": "Use safe serialization formats like JSON"
      },
      {
        "code": "yaml.load(user_input)",
        "vulnerability": "Unsafe YAML loading",
        "impact": "Code execution through YAML constructors",
        "mitigation": "Use yaml.safe_load"
      },
      {
        "code": "json.loads(untrusted_input)",
        "vulnerability": "JSON parsing without validation",
        "impact": "DoS through malformed JSON",
        "mitigation": "Validate JSON schema and size limits"
      }
    ],
    "safe_patterns": [
      {
        "code": "import yaml\ndata = yaml.safe_load(user_input)",
        "description": "Safe YAML loading without dangerous constructors"
      },
      {
        "code": "import json\nfrom jsonschema import validate\ndata = json.loads(input_data)\nvalidate(data, schema)",
        "description": "JSON parsing with schema validation"
      }
    ]
  },
  "authentication_bypass": {
    "description": "Patterns that may lead to authentication bypass",
    "high_risk_patterns": [
      {
        "code": "if password == stored_password:",
        "vulnerability": "Plain text password comparison",
        "impact": "Password disclosure, timing attacks",
        "mitigation": "Use secure password hashing"
      },
      {
        "code": "if user_role == 'admin' or bypass_flag:",
        "vulnerability": "Weak authorization logic",
        "impact": "Privilege escalation",
        "mitigation": "Implement proper role-based access control"
      },
      {
        "code": "token = base64.encode(user_id + ':' + timestamp)",
        "vulnerability": "Weak token generation",
        "impact": "Token forgery, session hijacking",
        "mitigation": "Use cryptographically secure tokens"
      }
    ],
    "safe_patterns": [
      {
        "code": "import bcrypt\nif bcrypt.checkpw(password.encode('utf-8'), stored_hash):",
        "description": "Secure password verification with bcrypt"
      },
      {
        "code": "from secrets import token_urlsafe\ntoken = token_urlsafe(32)",
        "description": "Cryptographically secure token generation"
      }
    ]
  },
  "information_disclosure": {
    "description": "Patterns that may leak sensitive information",
    "high_risk_patterns": [
      {
        "code": "print(f\"Error: {exception}\")",
        "vulnerability": "Detailed error messages in production",
        "impact": "Information disclosure, system enumeration",
        "mitigation": "Log detailed errors, show generic messages to users"
      },
      {
        "code": "return {'error': str(e), 'stack_trace': traceback.format_exc()}",
        "vulnerability": "Stack trace exposure",
        "impact": "Source code disclosure, attack vector identification",
        "mitigation": "Return generic error messages, log details internally"
      },
      {
        "code": "DEBUG = True  # In production",
        "vulnerability": "Debug mode in production",
        "impact": "Sensitive information exposure",
        "mitigation": "Disable debug mode in production"
      }
    ],
    "safe_patterns": [
      {
        "code": "logger.exception(\"Detailed error for debugging\")\nreturn {'error': 'An error occurred'}",
        "description": "Log detailed errors, return generic messages"
      },
      {
        "code": "if settings.DEBUG:\n    return {'error': str(e)}\nelse:\n    return {'error': 'Internal server error'}",
        "description": "Conditional error detail based on environment"
      }
    ]
  },
  "meta": {
    "version": "1.0",
    "last_updated": "2024-09-18",
    "description": "Security pattern database for vulnerability detection",
    "risk_levels": {
      "critical": "Immediate security risk requiring urgent attention",
      "high": "Significant security risk that should be addressed soon",
      "medium": "Potential security risk requiring review",
      "low": "Minor security consideration"
    },
    "detection_confidence": {
      "high": "Pattern strongly indicates vulnerability",
      "medium": "Pattern suggests possible vulnerability",
      "low": "Pattern may be vulnerable depending on context"
    }
  }
}